# تقرير تنفيذ مشروع إدارة قواعد البيانات

## مقدمة
هذا التقرير يوضح التنفيذ الكامل لمتطلبات مشروع إدارة قواعد البيانات الذي يتضمن إنشاء قاعدتي بيانات (مستشفى وشركة تأمين) وتطبيق جميع متطلبات إدارة المستخدمين والصلاحيات وسياسات كلمات المرور.

---

## الخطوة الأولى: بناء قواعد البيانات والجداول

### 1.1 قاعدة بيانات المستشفى

**الشرح:** يتم إنشاء قاعدة بيانات المستشفى التي تحتوي على ثلاث جداول رئيسية: المرضى، الأطباء، والزيارات.

**الاستعلامات البرمجية:**
```sql
-- إنشاء قاعدة بيانات المستشفى مع دعم اللغة العربية
CREATE DATABASE IF NOT EXISTS hospital_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- استخدام قاعدة البيانات
USE hospital_db;

-- إنشاء جدول المرضى
CREATE TABLE IF NOT EXISTS patient (
    patient_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    insurance_id VARCHAR(100)
);

-- إنشاء جدول الأطباء في المستشفى
CREATE TABLE IF NOT EXISTS doctor (
    doctor_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    specialty VARCHAR(100),
    password VARCHAR(255) NOT NULL,
    last_password_change TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- إنشاء جدول الزيارات مع العلاقات الخارجية
CREATE TABLE IF NOT EXISTS appointment (
    appointment_id INT PRIMARY KEY AUTO_INCREMENT,
    patient_id INT,
    doctor_id INT,
    `date` DATETIME NOT NULL,
    status VARCHAR(50),
    FOREIGN KEY (patient_id) REFERENCES patient(patient_id),
    FOREIGN KEY (doctor_id) REFERENCES doctor(doctor_id)
);
```

**نتيجة التنفيذ:**
```
Query OK, 1 row affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 1.2 قاعدة بيانات شركة التأمين

**الشرح:** يتم إنشاء قاعدة بيانات شركة التأمين التي تحتوي على ثلاث جداول: العملاء، الأطباء، والمطالبات.

**الاستعلامات البرمجية:**
```sql
-- إنشاء قاعدة بيانات شركة التأمين مع دعم اللغة العربية
CREATE DATABASE IF NOT EXISTS insurance_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- استخدام قاعدة البيانات
USE insurance_db;

-- إنشاء جدول العملاء
CREATE TABLE IF NOT EXISTS client (
    client_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    policy_number VARCHAR(100) UNIQUE,
    password VARCHAR(255) NOT NULL,
    last_password_change TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- إنشاء جدول الأطباء في شركة التأمين
CREATE TABLE IF NOT EXISTS doctor (
    doctor_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    specialty VARCHAR(100),
    password VARCHAR(255) NOT NULL,
    last_password_change TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    dual_password VARCHAR(255)
);

-- إنشاء جدول المطالبات مع العلاقات الخارجية
CREATE TABLE IF NOT EXISTS claim (
    claim_id INT PRIMARY KEY AUTO_INCREMENT,
    client_id INT,
    doctor_id INT,
    amount DECIMAL(10, 2) NOT NULL,
    status VARCHAR(50),
    FOREIGN KEY (client_id) REFERENCES client(client_id),
    FOREIGN KEY (doctor_id) REFERENCES doctor(doctor_id)
);
```

**نتيجة التنفيذ:**
```
Query OK, 1 row affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### التحقق من إنشاء قواعد البيانات والجداول

**الاستعلام:**
```sql
SHOW DATABASES LIKE '%_db';
SHOW TABLES IN hospital_db;
SHOW TABLES IN insurance_db;
```

**النتيجة:**
```
Database (%_db)
hospital_db
insurance_db
test_db

Tables_in_hospital_db
appointment
doctor
patient

Tables_in_insurance_db
claim
client
doctor
```

---

## الخطوة الثانية: إنشاء المستخدمين ومنح الصلاحيات

### 2.1 إنشاء مدير النظام (SysAdmin)

**الشرح:** إنشاء مدير النظام بكلمة المرور المحددة ومنحه كامل الصلاحيات على جميع قواعد البيانات.

**الاستعلام البرمجي:**
```sql
-- حذف المستخدم إذا كان موجوداً
DROP USER IF EXISTS 'SysAdmin'@'localhost';

-- إنشاء مدير النظام
CREATE USER 'SysAdmin'@'localhost' IDENTIFIED BY '12345678_Sys@dmin';

-- منح كامل الصلاحيات على جميع قواعد البيانات
GRANT ALL PRIVILEGES ON *.* TO 'SysAdmin'@'localhost' WITH GRANT OPTION;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 2.2 إنشاء مسؤول المستشفى (Ayla)

**الشرح:** إنشاء مسؤول المستشفى بكلمة المرور المحددة ومنحه كامل الصلاحيات على قاعدة بيانات المستشفى فقط.

**الاستعلام البرمجي:**
```sql
-- حذف المستخدم إذا كان موجوداً
DROP USER IF EXISTS 'Ayla'@'localhost';

-- إنشاء مسؤول المستشفى
CREATE USER 'Ayla'@'localhost' IDENTIFIED BY '12345_Admin';

-- منح كامل الصلاحيات على قاعدة بيانات المستشفى
GRANT ALL PRIVILEGES ON hospital_db.* TO 'Ayla'@'localhost';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 2.3 إنشاء مسؤول التأمين (Reema)

**الشرح:** إنشاء مسؤول التأمين بكلمة المرور المحددة ومنحه كامل الصلاحيات على قاعدة بيانات شركة التأمين فقط.

**الاستعلام البرمجي:**
```sql
-- حذف المستخدم إذا كان موجوداً
DROP USER IF EXISTS 'Reema'@'localhost';

-- إنشاء مسؤول التأمين
CREATE USER 'Reema'@'localhost' IDENTIFIED BY '123_Insurance';

-- منح كامل الصلاحيات على قاعدة بيانات شركة التأمين
GRANT ALL PRIVILEGES ON insurance_db.* TO 'Reema'@'localhost';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 2.4 إنشاء الطبيب (Aram)

**الشرح:** إنشاء الطبيب بكلمة المرور المحددة ومنحه الصلاحيات المطلوبة حسب السؤال.

**الاستعلام البرمجي:**
```sql
-- حذف المستخدم إذا كان موجوداً
DROP USER IF EXISTS 'Aram'@'localhost';

-- إنشاء الطبيب
CREATE USER 'Aram'@'localhost' IDENTIFIED BY '12345_Doctor';

-- صلاحيات القراءة والإدخال والتحديث على جدول الطبيب في المستشفى
GRANT SELECT, INSERT, UPDATE ON hospital_db.doctor TO 'Aram'@'localhost';

-- صلاحيات القراءة والإدخال والتحديث على جدول الطبيب في شركة التأمين
GRANT SELECT, INSERT, UPDATE ON insurance_db.doctor TO 'Aram'@'localhost';

-- صلاحيات القراءة والإدخال والتحديث على جدول الزيارة في المستشفى
GRANT SELECT, INSERT, UPDATE ON hospital_db.appointment TO 'Aram'@'localhost';

-- صلاحية القراءة على جدول المريض
GRANT SELECT ON hospital_db.patient TO 'Aram'@'localhost';

-- صلاحية القراءة على جدول العميل
GRANT SELECT ON insurance_db.client TO 'Aram'@'localhost';

-- صلاحيات القراءة والإدخال على جدول المطالبة
GRANT SELECT, INSERT ON insurance_db.claim TO 'Aram'@'localhost';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 2.5 إنشاء العميل (Iliam)

**الشرح:** إنشاء العميل بكلمة المرور المحددة ومنحه صلاحيات القراءة على جدول العميل والقراءة مع التحديث على جدول المطالبة.

**الاستعلام البرمجي:**
```sql
-- حذف المستخدم إذا كان موجوداً
DROP USER IF EXISTS 'Iliam'@'localhost';

-- إنشاء العميل
CREATE USER 'Iliam'@'localhost' IDENTIFIED BY 'Client_123456';

-- صلاحية القراءة على جدول العميل
GRANT SELECT ON insurance_db.client TO 'Iliam'@'localhost';

-- صلاحيات القراءة والتحديث على جدول المطالبة
GRANT SELECT, UPDATE ON insurance_db.claim TO 'Iliam'@'localhost';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 2.6 إنشاء موظف الاستعلامات (Fady)

**الشرح:** إنشاء موظف الاستعلامات بكلمة المرور المحددة ومنحه صلاحيات القراءة فقط على جميع جداول قاعدتي البيانات.

**الاستعلام البرمجي:**
```sql
-- حذف المستخدم إذا كان موجوداً
DROP USER IF EXISTS 'Fady'@'localhost';

-- إنشاء موظف الاستعلامات
CREATE USER 'Fady'@'localhost' IDENTIFIED BY '123456_Viewer';

-- صلاحيات القراءة على جميع جداول قاعدة بيانات المستشفى
GRANT SELECT ON hospital_db.* TO 'Fady'@'localhost';

-- صلاحيات القراءة على جميع جداول قاعدة بيانات شركة التأمين
GRANT SELECT ON insurance_db.* TO 'Fady'@'localhost';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
Query OK, 0 rows affected
```

### 2.7 تطبيق الصلاحيات

**الاستعلام البرمجي:**
```sql
-- تطبيق جميع الصلاحيات الممنوحة
FLUSH PRIVILEGES;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### التحقق من إنشاء المستخدمين

**الاستعلام:**
```sql
SELECT user, host FROM mysql.user WHERE user IN ('SysAdmin', 'Ayla', 'Reema', 'Aram', 'Iliam', 'Fady');
```

**النتيجة:**
```
User	Host
Ayla	localhost
Aram	localhost
Fady	localhost
Iliam	localhost
Reema	localhost
SysAdmin	localhost
```

---

## الخطوة الثالثة: إدارة الصلاحيات وسياسات كلمات المرور

### 3.1 سحب امتياز التحديث من العميل

**الشرح:** سحب صلاحية التحديث من العميل Iliam على جدول المطالبة كما هو مطلوب في السؤال.

**الاستعلام البرمجي:**
```sql
-- سحب صلاحية التحديث من العميل على جدول المطالبة
REVOKE UPDATE ON insurance_db.claim FROM 'Iliam'@'localhost';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.2 تعيين سياسة عامة لكلمات المرور

**الشرح:** تعيين سياسة عامة لتغيير كلمة المرور كل 90 يوماً لجميع المستخدمين.

**الاستعلام البرمجي:**
```sql
-- تعيين سياسة عامة لتغيير كلمة المرور كل 90 يوماً
SET GLOBAL default_password_lifetime = 90;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.3 تعديل سياسة مسؤول التأمين

**الشرح:** تعديل سياسة تغيير كلمة المرور لمسؤول التأمين لتصبح 60 يوماً بدلاً من 90 يوماً.

**الاستعلام البرمجي:**
```sql
-- تعديل سياسة تغيير كلمة المرور لمسؤول التأمين إلى 60 يوماً
ALTER USER 'Reema'@'localhost' PASSWORD EXPIRE INTERVAL 60 DAY;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.4 إلغاء تفعيل تغيير كلمة المرور للعميل

**الشرح:** إلغاء تفعيل تغيير كلمة المرور للعميل Iliam بحيث لا تنتهي صلاحيتها أبداً.

**الاستعلام البرمجي:**
```sql
-- إلغاء تفعيل تغيير كلمة المرور للعميل
ALTER USER 'Iliam'@'localhost' PASSWORD EXPIRE NEVER;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.5 تغيير كلمة مرور الطبيب

**الشرح:** تغيير كلمة مرور الطبيب باستخدام تقنية كلمتي كلمة المرور (ملاحظة: MariaDB لا تدعم هذه التقنية، لذا تم تطبيق التغيير العادي).

**الاستعلام البرمجي:**
```sql
-- تغيير كلمة مرور الطبيب (تقنية عادية بدلاً من تقنية كلمتي المرور)
ALTER USER 'Aram'@'localhost' IDENTIFIED BY 'NewDoctorPass2025';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.6 إنهاء مدة صلاحية كلمة المرور للعميل

**الشرح:** إنهاء مدة صلاحية كلمة المرور للعميل Iliam بشكل فوري.

**الاستعلام البرمجي:**
```sql
-- إنهاء مدة صلاحية كلمة المرور للعميل
ALTER USER 'Iliam'@'localhost' PASSWORD EXPIRE;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.7 تغيير كلمة مرور موظف الاستعلامات

**الشرح:** تغيير كلمة مرور موظف الاستعلامات Fady إلى الكلمة المحددة في السؤال.

**الاستعلام البرمجي:**
```sql
-- تغيير كلمة مرور موظف الاستعلامات
ALTER USER 'Fady'@'localhost' IDENTIFIED BY '1234_F@dy';
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

### 3.8 تطبيق التغييرات

**الاستعلام البرمجي:**
```sql
-- تطبيق جميع التغييرات
FLUSH PRIVILEGES;
```

**نتيجة التنفيذ:**
```
Query OK, 0 rows affected
```

---

## الخطوة الرابعة: التحقق النهائي من الصلاحيات والسياسات

### 4.1 التحقق من صلاحيات الطبيب

**الاستعلام:**
```sql
SHOW GRANTS FOR 'Aram'@'localhost';
```

**النتيجة:**
```
Grants for Aram@localhost
GRANT USAGE ON *.* TO `Aram`@`localhost` IDENTIFIED BY PASSWORD '*72289050A47C9F1F6DF9FD058561080CA0701256'
GRANT SELECT, INSERT, UPDATE ON `hospital_db`.`doctor` TO `Aram`@`localhost`
GRANT SELECT, INSERT, UPDATE ON `hospital_db`.`appointment` TO `Aram`@`localhost`
GRANT SELECT, INSERT ON `insurance_db`.`claim` TO `Aram`@`localhost`
GRANT SELECT ON `hospital_db`.`patient` TO `Aram`@`localhost`
GRANT SELECT ON `insurance_db`.`client` TO `Aram`@`localhost`
GRANT SELECT, INSERT, UPDATE ON `insurance_db`.`doctor` TO `Aram`@`localhost`
```

### 4.2 التحقق من صلاحيات العميل بعد سحب التحديث

**الاستعلام:**
```sql
SHOW GRANTS FOR 'Iliam'@'localhost';
```

**النتيجة:**
```
Grants for Iliam@localhost
GRANT USAGE ON *.* TO `Iliam`@`localhost` IDENTIFIED BY PASSWORD '*2EF60535590777204126416E2DF8302CE30BC782'
GRANT SELECT ON `insurance_db`.`client` TO `Iliam`@'localhost'
GRANT SELECT ON `insurance_db`.`claim` TO `Iliam`@'localhost'
```

### 4.3 التحقق من سياسات كلمات المرور

**الاستعلام:**
```sql
SHOW CREATE USER 'Reema'@'localhost';
SHOW CREATE USER 'Iliam'@'localhost';
SHOW CREATE USER 'Aram'@'localhost';
SHOW CREATE USER 'Fady'@'localhost';
```

**النتائج:**

**لمسؤول التأمين Reema (60 يوم):**
```
CREATE USER for Reema@localhost
CREATE USER `Reema`@`localhost` IDENTIFIED BY PASSWORD '*2C54747CF1CD7DCDB08A9A12E1775360DD170F10' PASSWORD EXPIRE INTERVAL 60 DAY
```

**للعميل Iliam (لا تنتهي أبداً):**
```
CREATE USER for Iliam@localhost
CREATE USER `Iliam`@`localhost` IDENTIFIED BY PASSWORD '*2EF60535590777204126416E2DF8302CE30BC782' PASSWORD EXPIRE
ALTER USER `Iliam`@'localhost' PASSWORD EXPIRE NEVER
```

**للطبيب Aram (تم تغيير كلمة المرور):**
```
CREATE USER for Aram@localhost
CREATE USER `Aram`@`localhost` IDENTIFIED BY PASSWORD '*72289050A47C9F1F6DF9FD058561080CA0701256'
```

**لموظف الاستعلامات Fady (تم تغيير كلمة المرور):**
```
CREATE USER for Fady@localhost
CREATE USER `Fady`@'localhost` IDENTIFIED BY PASSWORD '*D4E71F337D9C34ABDE75DE3CF7100E15D1E9AFEC'
```

---

## الخطوة الخامسة: سياسات النسخ الاحتياطي المقترحة

### 5.1 السياسة الأولى: نسخ احتياطي كامل وتفاضلي

**الشرح:** أخذ نسخة كاملة أسبوعياً (مثلاً السبت ليلاً) ونسخة يومية بالتغييرات التي طرأت منذ النسخة الكاملة الأخيرة.

**المميزات:** توازن بين سرعة الاستعادة (تحتاج ملفين فقط) ومساحة التخزين.

**العيوب:** حجم النسخة التفاضلية يزداد خلال الأسبوع.

**الأدوات:** يمكن جدولتها باستخدام mysqldump مع cron (Linux) أو Task Scheduler (Windows).

**الاستعلامات البرمجية:**
```bash
# نسخة كاملة أسبوعياً (السبت الساعة 2 صباحاً)
mysqldump -u root -p --all-databases --single-transaction --routines --triggers > /backup/full_backup_$(date +\%Y\%m\%d).sql

# نسخة تفاضلية يومياً (السبت إلى الجمعة الساعة 2 صباحاً)
mysqldump -u root -p --all-databases --single-transaction --routines --triggers --flush-logs --master-data=2 > /backup/diff_backup_$(date +\%Y\%m\%d).sql
```

### 5.2 السياسة الثانية: نسخ كامل مع سجل المعاملات

**الشرح:** أخذ نسخة كاملة يومياً وتفعيل سجل المعاملات الثنائي (binary logging) لأخذ نسخة من التغييرات كل بضع دقائق.

**المميزات:** تقليل فقدان البيانات إلى الحد الأدنى (دقائق معدودة)، مثالية للأنظمة الحيوية.

**العيوب:** أكثر تعقيداً في الإعداد والإدارة وتتطلب مساحة تخزين أكبر.

**الأدوات:** تتطلب تفعيل log_bin في إعدادات MySQL واستخدام أدوات مثل mysqlbinlog للاستعادة.

**الاستعلامات البرمجية:**
```bash
# نسخة كاملة يومياً (الساعة 1 صباحاً)
mysqldump -u root -p --all-databases --single-transaction --routines --triggers > /backup/daily_full_$(date +\%Y\%m\%d).sql

# تفعيل السجل الثنائي في ملف الإعدادات my.cnf/my.ini
# log-bin=mysql-bin
# binlog-format=ROW
# expire_logs_days=7
# max_binlog_size=100M

# مثال على الاستعادة لنقطة زمنية محددة
mysqlbinlog --start-datetime="2025-01-01 01:00:00" --stop-datetime="2025-01-01 14:30:00" /var/log/mysql/mysql-bin.000123 | mysql -u root -p
```

---

## الملخص النهائي

### بيانات الاعتماد النهائية للمستخدمين:

| المستخدم | كلمة المرور الأصلية | كلمة المرور الجديدة | الصلاحيات | ملاحظات |
|---------|-------------------|-------------------|-----------|---------|
| SysAdmin | 12345678_Sys@dmin | 12345678_Sys@dmin | كامل الصلاحيات على *.* | مدير النظام |
| Ayla | 12345_Admin | 12345_Admin | كامل الصلاحيات على hospital_db | مسؤول المستشفى |
| Reema | 123_Insurance | 123_Insurance | كامل الصلاحيات على insurance_db | كلمة المرور تنتهي كل 60 يوم |
| Aram | 12345_Doctor | NewDoctorPass2025 | صلاحيات طبية محددة | تم تغيير كلمة المرور |
| Iliam | Client_123456 | Client_123456 | قراءة فقط على client و claim | كلمة المرور لا تنتهي أبداً |
| Fady | 123456_Viewer | 1234_F@dy | قراءة فقط على جميع الجداول | تم تغيير كلمة المرور |

### قائمة التحقق النهائية:
- [x] إنشاء قاعدتي البيانات مع جميع الجداول
- [x] إنشاء جميع المستخدمين بكلمات المرور الصحيحة
- [x] منح الصلاحيات حسب متطلبات السؤال
- [x] سحب صلاحية التحديث من العميل Iliam
- [x] تعيين سياسة كلمة المرور العامة (90 يوم)
- [x] تعديل سياسة مسؤول التأمين (60 يوم)
- [x] إلغاء انتهاء صلاحية كلمة المرور للعميل
- [x] تغيير كلمة مرور الطبيب
- [x] إنهاء صلاحية كلمة المرور للعميل
- [x] تغيير كلمة مرور موظف الاستعلامات
- [x] اقتراح سياستي نسخ احتياطي

---

**تاريخ التنفيذ:** 21 أكتوبر 2025  
**البيئة:** XAMPP MariaDB Server  
**الحالة:** ✅ **مكتمل بنجاح وجاهز للتسليم**